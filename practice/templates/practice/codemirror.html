<html>
  <head>
    <title>Codemirror</title>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
    <script src="http://www.skulpt.org/static/skulpt.min.js" type="text/javascript"></script>
    <script src="http://www.skulpt.org/static/skulpt-stdlib.js" type="text/javascript"></script>

    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static 'practice/assets/codemirror/theme/material.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'practice/assets/codemirror/lib/codemirror.css' %}">

    <style>

      #code {
        max-width: 800px;
        max-height: 1000px;
      }

      #button1 {
        font: bold 11px Arial;
        text-decoration: none;
        background-color: #EEEEEE;
        color: #333333;
        padding: 2px 6px 2px 6px;
        border-top: 1px solid #CCCCCC;
        border-right: 1px solid #333333;
        border-bottom: 1px solid #333333;
        border-left: 1px solid #CCCCCC;
        }

    </style>
  </head>


  <body>
    <div id="code"></div>
    <!-- Javascript here -->

    <br>

    <br>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="{% static 'practice/assets/codemirror/lib/codemirror.js' %}"></script>
    <script type="text/javascript" src="{% static 'practice/assets/codemirror/mode/python/python.js' %}"></script>

    <script type="text/javascript">
      $(document).ready(function(){
        var editor = CodeMirror.fromTextArea(document.getElementById("yourcode"), {
          lineNumbers: true,
          mode: "python",
          theme: "material"
        });
      });

    </script>
<!--
  On clicking the submit button on practice/CodeMirror a new page should open(solution.html) showing the variable 'url'
  See solution.html and views.py for more
-->
    <script type="text/javascript">

      $("#button").click(function(e) {
        e.preventDefault();

        var url = 400; //editor.value to be entered atually but testing for 400 on new page;

        $.ajax({
          type: "POST",
          url: "{% url 'practice:solution' %}",
          data: {
            'url': url,
            csrfmiddlewaretoken: '{{ csrf_token }}'
          },
          success: function(){
            alert("Successfully sent the URL to Django");
          },
          error: function(){
            console.log('Failure');
          }
        })
      })

    </script>

















<script type="text/javascript">
// output functions are configurable.  This one just appends some text
// to a pre element.
function outf(text) {
    var mypre = document.getElementById("output");
    mypre.innerHTML = mypre.innerHTML + text;
}
function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
}
// Here's everything you need to run a python program in skulpt
// grab the code from your textarea
// get a reference to your pre element for output
// configure the output function
// call Sk.importMainWithBody()
function runit() {
   var prog = document.getElementById("yourcode").value;
   var mypre = document.getElementById("output");
   mypre.innerHTML = '';
   Sk.pre = "output";
   Sk.configure({output:outf, read:builtinRead});
   (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
   var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
   });
   myPromise.then(function(mod) {
       console.log('success');
   },
       function(err) {
       console.log(err.toString());
   });
}
</script>

<h3>Try This</h3>
<form>
<textarea id="yourcode" cols="40" rows="10">print "Hello World"</textarea><br />
<button type="button" onclick="runit()">Run</button>
</form>
<pre id="output" ></pre>

</body>

</html>
